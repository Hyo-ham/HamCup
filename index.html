<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>í–„ì»µ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
    margin: 0;
    background: #f8f6f0;
    font-family: "Pretendard", sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
}
h1 {
    margin-top: 10px;
    font-size: 28px;
    font-weight: 700;
    color: #5a463a;
}
button {
    padding: 12px 20px;
    margin-top: 10px;
    border: none;
    border-radius: 10px;
    background: #ffcf6b;
    font-size: 16px;
    color: #5a463a;
    font-weight: 600;
    cursor: pointer;
}
.round-label {
    margin: 10px 0;
    font-size: 18px;
    color: #6c584b;
    font-weight: 500;
}
#gameBox {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    width: 100%;
    max-width: 800px;
}
.candidate-card {
    flex: 1;
    background: white;
    border-radius: 20px;
    box-shadow: 0px 4px 10px rgba(0,0,0,0.1);
    overflow: hidden;
    cursor: pointer;
    transition: transform 0.15s ease;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px;
}
.candidate-card {
    flex: 1;
    background: white;
    border-radius: 20px;
    box-shadow: 0px 4px 10px rgba(0,0,0,0.1);
    overflow: hidden;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px;
}

.candidate-img {
    width: 100%;
    height: auto;
    max-height: 500px;      /* ë„ˆë¬´ ê¸¸ë©´ ìë™ ì œí•œ */
    object-fit: contain;    /* ì´ë¯¸ì§€ ì˜ë¦¼ ë°©ì§€ */
    border-radius: 15px;
    background: #fff;
}
.candidate-name {
    text-align: center;
    padding: 10px;
    font-size: 18px;
    color: #4a3b31;
    font-weight: 600;
    word-break: break-word;
    width: 100%;
}
#resultBox {
    margin-top: 20px;
    text-align: center;
    display: none;
}
#resultBox img {
    width: 85%;
    max-width: 350px;
    border-radius: 20px;
    box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    margin-bottom: 10px;
}
</style>
</head>
<body>

<h1>ğŸ¹ ìµœê³ ì˜ í–„ì„ ì°¾ì•„ì„œ</h1>

<!-- ğŸ”¥ ë¼ìš´ë“œ ì„ íƒ UI -->
<select id="roundSelect" style="padding:10px; margin-top:10px; border-radius:10px; font-size:16px;">
    <option value="4">4ê°•</option>
    <option value="8" selected>8ê°•</option>
    <option value="16">16ê°•</option>
    <option value="32">32ê°•</option>
    <option value="64">64ê°•</option>
</select>

<button onclick="start()">ì‹œì‘í•˜ê¸°</button>

<div id="roundLabel" class="round-label"></div>

<div id="gameBox" style="display:none;">
    <div id="leftCard" class="candidate-card" onclick="select(0)">
        <img id="leftImg" class="candidate-img">
        <div id="leftName" class="candidate-name"></div>
    </div>
<h1> VS </h1>
    <div id="rightCard" class="candidate-card" onclick="select(1)">
        <img id="rightImg" class="candidate-img">
        <div id="rightName" class="candidate-name"></div>
    </div>
</div>

<div id="resultBox">
    <h2>ğŸ† ìµœê³ ì˜ í–„!!!</h2>
    <img id="resultImg">
    <div id="resultName" class="candidate-name"></div>
</div>

<script>
let candidates = [];
let nextRound = [];
let index = 0;

const imageExtensions = ["jpg", "jpeg", "png", "gif", "JPG", "JPEG", "PNG", "GIF"];

// ì´ë¯¸ì§€ ìë™ í™•ì¥ì íƒìƒ‰
function loadImageAuto(pathBase, imgEl) {
    let i = 0;

    function tryNext() {
        if (i >= imageExtensions.length) {
            imgEl.style.display = "none";
            return;
        }

        const path = `${pathBase}.${imageExtensions[i]}`;

        const img = new Image();
        img.onload = () => {
            imgEl.src = path;
            imgEl.style.display = "block";
        };
        img.onerror = () => {
            i++;
            tryNext(); // ë‹¤ìŒ í™•ì¥ì ì‹œë„
        };
        img.src = path;
    }
    tryNext();
}

// CSV ìë™ ë¡œë”©
window.onload = async function () {
    const url = "https://raw.githubusercontent.com/Hyo-ham/HamCup/refs/heads/main/name.csv";

    try {
        const res = await fetch(url);
        const text = await res.text();
        const lines = text.split("\n").map(v => v.trim());

        let list = [];
        for (let i = 1; i < lines.length; i++) {
            if (!lines[i]) continue;
            const name = lines[i].split(",")[0].trim();
            if (name) list.push({ name: name });
        }

        candidates = list;
        console.log("CSV ë¡œë“œë¨:", candidates);

    } catch (err) {
        alert("CSV ë¡œë“œ ì‹¤íŒ¨!");
        console.error(err);
    }
};

//ì´ë¯¸ì§€ ì‚¬ì „ ë¡œë“œ
    function preloadImage(name) {
    return new Promise(resolve => {
        const extensions = ["jpg", "jpeg", "png", "gif", "webp"];
        let tried = 0;

        function tryNext() {
            if (tried >= extensions.length) return resolve(); // ì‹¤íŒ¨í•´ë„ resolve

            const ext = extensions[tried++];
            const img = new Image();
            img.onload = () => resolve();
            img.onerror = () => tryNext();
            img.src = `images/${name}.${ext}`;
        }

        tryNext();
    });
}
    
//ì‹œì‘
function start() {
    const roundCount = parseInt(document.getElementById("roundSelect").value);

    if (candidates.length < roundCount) {
        alert(`í›„ë³´ê°€ ${roundCount}ëª…ë³´ë‹¤ ì ì–´ìš”!`);
        return;
    }

    shuffle(candidates);

    // ì„ íƒí•œ ê°•ìˆ˜ë§Œí¼ ìë¥´ê¸°
    candidates = candidates.slice(0, roundCount);

    index = 0;
    nextRound = [];

    // ì‹œì‘ ë²„íŠ¼, ë¼ìš´ë“œ ì„ íƒ UI ìˆ¨ê¸°ê¸°
    document.getElementById("roundSelect").style.display = "none";
    document.querySelector("button").style.display = "none"; 

    showNextMatch();
    document.getElementById("gameBox").style.display = "flex";
}

// ì„ê¸°
function shuffle(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
}

// ê²½ê¸° í‘œì‹œ
async function showNextMatch() {
    const left = candidates[index];
    const right = candidates[index + 1];

    document.getElementById("roundLabel").textContent = `${candidates.length}ê°• ì§„í–‰ì¤‘`;

    // ìˆ¨ê¸°ê¸°
    const box = document.getElementById("gameBox");
    box.style.opacity = "0";

    // ì´ë¯¸ì§€ ë¡œë”© ëŒ€ê¸°
    await Promise.all([
        preloadImage(left.name),
        right ? preloadImage(right.name) : Promise.resolve()
    ]);

    // ë¡œë”© ì™„ë£Œ í›„ *í•œ ë²ˆì—* ì´ë¦„ + ì´ë¯¸ì§€ ì„¤ì •
    setupCard(left, "leftImg", "leftName");

    if (right) {
        document.getElementById("rightCard").style.display = "flex";
        setupCard(right, "rightImg", "rightName");
    } else {
        document.getElementById("rightCard").style.display = "none"; // ë¶€ì „ìŠ¹
    }

    // ë‚˜íƒ€ë‚´ê¸°
    setTimeout(() => { 
        box.style.opacity = "1"; 
    }, 50);
}

// ì¹´ë“œ UI ì„¸íŒ…
function setupCard(data, imgId, nameId) {
    const imgEl = document.getElementById(imgId);
    const nameEl = document.getElementById(nameId);

    // 1) UI ë¨¼ì € ì´ˆê¸°í™” (ğŸ‘‰ ì´ì „ ì´ë¯¸ì§€ê°€ ë‚¨ì•„ìˆì§€ ì•Šê²Œ)
    imgEl.src = "";
    imgEl.style.display = "none";
    nameEl.textContent = "";

    // 2) ì´ë¯¸ì§€ ë¡œë”© ì™„ë£Œ í›„ ë°˜ì˜
    const pathBase = `images/${data.name}`;

    loadImageAuto(pathBase, imgEl);

    // 3) ì´ë¦„ì€ ì´ë¯¸ì§€ í‘œì‹œ ì§ì „ì— ë°˜ì˜ (ê¹œë¹¡ì„ ë°©ì§€)
    nameEl.textContent = data.name;
}
// ì„ íƒ
function select(choice) {
    const left = candidates[index];
    const right = candidates[index + 1];

    if (choice === 0) nextRound.push(left);
    else if (right) nextRound.push(right);

    index += 2;

    if (index >= candidates.length) {
        candidates = nextRound;
        nextRound = [];
        index = 0;

        if (candidates.length === 1) {
            showResult(candidates[0]);
            return;
        }
    }

    showNextMatch();
}

// ìš°ìŠ¹ ì¶œë ¥
function showResult(winner) {
    document.getElementById("gameBox").style.display = "none";
    document.getElementById("roundLabel").style.display = "none";

    document.getElementById("resultName").textContent = winner.name;

    const resultImg = document.getElementById("resultImg");
    const pathBase = `images/${winner.name}`;

    loadImageAuto(pathBase, resultImg);

    document.getElementById("resultBox").style.display = "block";
}
</script>

</body>
</html>










