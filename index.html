<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ÌñÑÏªµ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
    margin: 0;
    background: #f8f6f0;
    font-family: "Pretendard", sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
}
h1 {
    margin-top: 10px;
    font-size: 28px;
    font-weight: 700;
    color: #5a463a;
}
button {
    padding: 12px 20px;
    margin-top: 10px;
    border: none;
    border-radius: 10px;
    background: #ffcf6b;
    font-size: 16px;
    color: #5a463a;
    font-weight: 600;
    cursor: pointer;
}
.round-label {
    margin: 10px 0;
    font-size: 18px;
    color: #6c584b;
    font-weight: 500;
}
#gameBox {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    width: 100%;
    max-width: 800px;
    opacity: 1;
    transition: opacity 0.25s ease;
}
.candidate-card {
    flex: 1;
    background: white;
    border-radius: 20px;
    box-shadow: 0px 4px 10px rgba(0,0,0,0.1);
    overflow: hidden;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px;
}
.candidate-img {
    width: 100%;
    max-height: 260px;
    object-fit: contain;
    border-radius: 15px;
    background: #f2f2f2;
}
.candidate-name {
    text-align: center;
    padding: 10px;
    font-size: 18px;
    color: #4a3b31;
    font-weight: 600;
    word-break: break-word;
    width: 100%;
}
#resultBox {
    margin-top: 20px;
    text-align: center;
    display: none;
}
#resultBox img {
    width: 85%;
    max-width: 350px;
    border-radius: 20px;
    box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    margin-bottom: 10px;
}
</style>
</head>
<body>

<h1>üêπ ÏµúÍ≥†Ïùò ÌñÑÏùÑ Ï∞æÏïÑÏÑú</h1>

<select id="roundSelect" style="padding:10px; margin-top:10px; border-radius:10px; font-size:16px;">
    <option value="4">4Í∞ï</option>
    <option value="8" selected>8Í∞ï</option>
    <option value="16">16Í∞ï</option>
    <option value="32">32Í∞ï</option>
    <option value="64">64Í∞ï</option>
</select>

<button onclick="start()">ÏãúÏûëÌïòÍ∏∞</button>

<div id="roundLabel" class="round-label"></div>

<div id="gameBox" style="display:none;">
    <div id="leftCard" class="candidate-card" onclick="select(0)">
        <img id="leftImg" class="candidate-img">
        <div id="leftName" class="candidate-name"></div>
    </div>
    <h1> VS </h1>
    <div id="rightCard" class="candidate-card" onclick="select(1)">
        <img id="rightImg" class="candidate-img">
        <div id="rightName" class="candidate-name"></div>
    </div>
</div>

<div id="resultBox">
    <h2>üèÜ ÏµúÍ≥†Ïùò ÌñÑ!!!</h2>
    <img id="resultImg">
    <div id="resultName" class="candidate-name"></div>
</div>

<script>
let candidates = [];
let nextRound = [];
let index = 0;

const imageExtensions = ["jpg", "jpeg", "png", "gif", "webp", "HEIC","jfif"];

// Ïù¥ÎØ∏ÏßÄ ÌôïÏû•Ïûê ÏûêÎèô ÌÉêÏÉâ
function loadImageAuto(pathBase, imgEl) {
    let i = 0;

    function tryNext() {
        if (i >= imageExtensions.length) {
            imgEl.style.display = "none";
            return;
        }

        const path = `${pathBase}.${imageExtensions[i]}`;

        const img = new Image();
        img.onload = () => {
            imgEl.src = path;
            imgEl.style.display = "block";
        };
        img.onerror = () => {
            i++;
            tryNext();
        };
        img.src = path;
    }
    tryNext();
}

// Ïù¥ÎØ∏ÏßÄ ÏÇ¨Ï†Ñ Î°úÎìú
function preloadImage(name) {
    return new Promise(resolve => {
        let tried = 0;

        function tryNext() {
            if (tried >= imageExtensions.length) return resolve();

            const ext = imageExtensions[tried++];
            const img = new Image();

            img.onload = () => resolve();
            img.onerror = () => tryNext();

            img.src = `images/${name}.${ext}`;
        }

        tryNext();
    });
}

// Ïπ¥Îìú Ï¥àÍ∏∞Ìôî
function clearCard(imgId, nameId) {
    const imgEl = document.getElementById(imgId);
    const nameEl = document.getElementById(nameId);

    imgEl.src = "";
    imgEl.style.display = "none";
    nameEl.textContent = "";
}

// Ïπ¥Îìú ÏÑ∏ÌåÖ
function setupCard(data, imgId, nameId) {
    const imgEl = document.getElementById(imgId);
    const nameEl = document.getElementById(nameId);

    nameEl.textContent = data.name;
    loadImageAuto(`images/${data.name}`, imgEl);
}

// CSV Î°úÎî©
window.onload = async function () {
    const url = "https://raw.githubusercontent.com/Hyo-ham/HamCup/refs/heads/main/name.csv";

    try {
        const res = await fetch(url);
        const text = await res.text();
        const lines = text.split("\n").map(v => v.trim());

        let list = [];
        for (let i = 1; i < lines.length; i++) {
            if (!lines[i]) continue;
            const name = lines[i].split(",")[0].trim();
            if (name) list.push({ name: name });
        }

        candidates = list;
        console.log("CSV Î°úÎìúÎê®:", candidates);

    } catch (err) {
        alert("CSV Î°úÎìú Ïã§Ìå®!");
    }
};

// ÏãúÏûë
function start() {
    const roundCount = parseInt(document.getElementById("roundSelect").value);

    if (candidates.length < roundCount) {
        alert(`ÌõÑÎ≥¥Í∞Ä ${roundCount}Î™ÖÎ≥¥Îã§ Ï†ÅÏñ¥Ïöî!`);
        return;
    }

    shuffle(candidates);
    candidates = candidates.slice(0, roundCount);

    index = 0;
    nextRound = [];

    document.getElementById("roundSelect").style.display = "none";
    document.querySelector("button").style.display = "none";

    document.getElementById("gameBox").style.display = "flex";

    showNextMatch();
}

// Î∞∞Ïó¥ ÏÑûÍ∏∞
function shuffle(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
}

// Îã§Ïùå Í≤ΩÍ∏∞ ÌëúÏãú
async function showNextMatch() {
    const left = candidates[index];
    const right = candidates[index + 1];

    const box = document.getElementById("gameBox");
    document.getElementById("roundLabel").textContent = `${candidates.length}Í∞ï ÏßÑÌñâÏ§ë`;

    // 1) Î®ºÏ†Ä Ïπ¥Îìú Ïà®Í∏∞Í∏∞
    box.style.opacity = "0";

    // 2) Ïπ¥Îìú UI Ï¥àÍ∏∞Ìôî (ÏûîÏÉÅ Î∞©ÏßÄ)
    clearCard("leftImg", "leftName");
    clearCard("rightImg", "rightName");

    // 3) Ïù¥ÎØ∏ÏßÄ Î°úÎî© Í∏∞Îã§Î¶¨Í∏∞
    await Promise.all([
        preloadImage(left.name),
        right ? preloadImage(right.name) : Promise.resolve()
    ]);

    // 4) Î™®Îì† Î°úÎî© ÎÅùÎÇú ÌõÑ UI Ï±ÑÏö∞Í∏∞
    setupCard(left, "leftImg", "leftName");

    if (right) {
        document.getElementById("rightCard").style.display = "flex";
        setupCard(right, "rightImg", "rightName");
    } else {
        document.getElementById("rightCard").style.display = "none";
    }

    // 5) Îã§Ïãú Ï≤úÏ≤úÌûà ÎÇòÌÉÄÎÇòÍ∏∞
    setTimeout(() => box.style.opacity = "1", 50);
}

// ÏÑ†ÌÉù
function select(choice) {
    const left = candidates[index];
    const right = candidates[index + 1];

    if (choice === 0) nextRound.push(left);
    else if (right) nextRound.push(right);

    index += 2;

    if (index >= candidates.length) {
        candidates = nextRound;
        nextRound = [];
        index = 0;

        if (candidates.length === 1) {
            showResult(candidates[0]);
            return;
        }
    }

    showNextMatch();
}

// ÏµúÏ¢Ö Í≤∞Í≥º
function showResult(winner) {
    document.getElementById("gameBox").style.display = "none";
    document.getElementById("roundLabel").style.display = "none";

    document.getElementById("resultName").textContent = winner.name;

    const resultImg = document.getElementById("resultImg");
    loadImageAuto(`images/${winner.name}`, resultImg);

    document.getElementById("resultBox").style.display = "block";
}
</script>

</body>
</html>


