<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ÌñÑÏªµ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
    margin: 0;
    background: #f8f6f0;
    font-family: "Pretendard", sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
}
h1 {
    margin-top: 10px;
    font-size: 28px;
    font-weight: 700;
    color: #5a463a;
}
button {
    padding: 12px 20px;
    margin-top: 10px;
    border: none;
    border-radius: 10px;
    background: #ffcf6b;
    font-size: 16px;
    color: #5a463a;
    font-weight: 600;
    cursor: pointer;
}
.round-label {
    margin: 10px 0;
    font-size: 18px;
    color: #6c584b;
    font-weight: 500;
}
#gameBox {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    width: 100%;
    max-width: 800px;
    opacity: 1;
    transition: opacity 0.25s ease;
}
.candidate-card {
    flex: 1;
    background: white;
    border-radius: 20px;
    box-shadow: 0px 4px 10px rgba(0,0,0,0.1);
    overflow: hidden;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px;
}
.candidate-img {
    width: 100%;
    max-height: 260px;
    object-fit: contain;
    border-radius: 15px;
    background: #f2f2f2;
}
.candidate-name {
    text-align: center;
    padding: 10px;
    font-size: 18px;
    color: #4a3b31;
    font-weight: 600;
    word-break: break-word;
    width: 100%;
}
#resultBox {
    margin-top: 20px;
    text-align: center;
    display: none;
}
#resultBox img {
    width: 85%;
    max-width: 350px;
    border-radius: 20px;
    box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    margin-bottom: 10px;
}
</style>
</head>
<body>

<h1>üêπ ÏµúÍ≥†Ïùò ÌñÑÏùÑ Ï∞æÏïÑÏÑú</h1>

<button onclick="start()">ÏãúÏûëÌïòÍ∏∞</button>

<div id="roundLabel" class="round-label"></div>

<div id="gameBox" style="display:none;">
    <div id="leftCard" class="candidate-card" onclick="select(0)">
        <img id="leftImg" class="candidate-img">
        <div id="leftName" class="candidate-name"></div>
    </div>
    <h1> VS </h1>
    <div id="rightCard" class="candidate-card" onclick="select(1)">
        <img id="rightImg" class="candidate-img">
        <div id="rightName" class="candidate-name"></div>
    </div>
</div>

<div id="resultBox">
    <h2>üèÜ ÏµúÍ≥†Ïùò ÌñÑ!!!</h2>
    <img id="resultImg">
    <div id="resultName" class="candidate-name"></div>
</div>

<script>
let candidates = [];
let nextRound = [];
let index = 0;

const imageExtensions = ["jpg", "jpeg", "png", "gif", "webp", "HEIC","jfif", "PNG", "JPG"];

// Ïù¥ÎØ∏ÏßÄ ÏûêÎèô Î°úÎìú
function loadImageAuto(pathBase, imgEl) {
    let i = 0;

    function tryNext() {
        if (i >= imageExtensions.length) {
            imgEl.style.display = "none";
            return;
        }
        const path = `${pathBase}.${imageExtensions[i]}`;
        const img = new Image();
        img.onload = () => {
            imgEl.src = path;
            imgEl.style.display = "block";
        };
        img.onerror = () => {
            i++;
            tryNext();
        };
        img.src = path;
    }
    tryNext();
}

// Ïù¥ÎØ∏ÏßÄ ÏÇ¨Ï†Ñ Î°úÎìú
function preloadImage(name) {
    return new Promise(resolve => {
        let tried = 0;
        function tryNext() {
            if (tried >= imageExtensions.length) return resolve();
            const img = new Image();
            img.onload = () => resolve();
            img.onerror = () => tryNext();
            img.src = `images/${name}.${imageExtensions[tried++]}`;
        }
        tryNext();
    });
}

function clearCard(imgId, nameId) {
    document.getElementById(imgId).style.display = "none";
    document.getElementById(nameId).textContent = "";
}

function setupCard(data, imgId, nameId) {
    document.getElementById(nameId).textContent = data.name;
    loadImageAuto(`images/${data.name}`, document.getElementById(imgId));
}

// CSV Î°úÎìú
window.onload = async function () {
    const url = "https://raw.githubusercontent.com/Hyo-ham/HamCup/refs/heads/main/name.csv";

    const res = await fetch(url);
    const text = await res.text();
    const lines = text.split("\n").map(v => v.trim());

    candidates = [];
    for (let i = 1; i < lines.length; i++) {
        if (!lines[i]) continue;
        candidates.push({ name: lines[i].split(",")[0] });
    }

    console.log("Ï¥ù ÌõÑÎ≥¥ Ïàò:", candidates.length);
};

// ÏãúÏûë (Ï†ÑÏ≤¥ ÌõÑÎ≥¥ ÏûêÎèô)
function start() {
    if (candidates.length < 2) {
        alert("ÌõÑÎ≥¥Í∞Ä Î∂ÄÏ°±Ìï©ÎãàÎã§.");
        return;
    }

    shuffle(candidates);
    index = 0;
    nextRound = [];

    document.querySelector("button").style.display = "none";
    document.getElementById("gameBox").style.display = "flex";

    showNextMatch();
}

// Î∞∞Ïó¥ ÏÑûÍ∏∞
function shuffle(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
}

// Îã§Ïùå Îß§Ïπò
async function showNextMatch() {
    const left = candidates[index];
    const right = candidates[index + 1];

    document.getElementById("roundLabel").textContent = `${candidates.length}Í∞ï ÏßÑÌñâÏ§ë`;

    const box = document.getElementById("gameBox");
    box.style.opacity = "0";

    clearCard("leftImg", "leftName");
    clearCard("rightImg", "rightName");

    await Promise.all([
        preloadImage(left.name),
        right ? preloadImage(right.name) : Promise.resolve()
    ]);

    setupCard(left, "leftImg", "leftName");

    if (right) {
        document.getElementById("rightCard").style.display = "flex";
        setupCard(right, "rightImg", "rightName");
    } else {
        document.getElementById("rightCard").style.display = "none";
    }

    setTimeout(() => box.style.opacity = "1", 50);
}

// ÏÑ†ÌÉù
function select(choice) {
    const left = candidates[index];
    const right = candidates[index + 1];

    nextRound.push(choice === 0 ? left : right);

    index += 2;

    if (index >= candidates.length) {
        candidates = nextRound;
        nextRound = [];
        index = 0;

        if (candidates.length === 1) {
            showResult(candidates[0]);
            return;
        }
    }
    showNextMatch();
}

// Í≤∞Í≥º
function showResult(winner) {
    document.getElementById("gameBox").style.display = "none";
    document.getElementById("roundLabel").style.display = "none";
    document.getElementById("resultName").textContent = winner.name;
    loadImageAuto(`images/${winner.name}`, document.getElementById("resultImg"));
    document.getElementById("resultBox").style.display = "block";
}
</script>

</body>
</html>
